<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Добавити оголошення</title>
  <link rel="stylesheet" th:href="@{/css/header-style.css}">
  <link rel="stylesheet" th:href="@{/css/footer-style.css}">
  <link rel="stylesheet" th:href="@{/css/property-add.css}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>
<div class="container ct">
  <h1>Додати оголошення</h1>
  <form th:action="@{/properties/add}" method="POST" th:object="${property}" class="property-form">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

    <!-- Існуючі поля -->
    <div class="form-group">
      <label for="title">Назва</label>
      <input type="text" id="title" name="title" required>
    </div>

    <div class="form-group">
      <label for="description">Опис</label>
      <textarea id="description" name="description" required></textarea>
    </div>

    <!-- Нові поля для адреси -->
    <div class="form-group">
      <label for="residentialComplex">Житловий комплекс</label>
      <input type="text" id="residentialComplex" name="residentialComplex">
    </div>

    <div class="form-group">
      <label for="district">Район</label>
      <input type="text" id="district" name="district">
    </div>

    <div class="form-group">
      <label for="areaName">Мікрорайон</label>
      <input type="text" id="areaName" name="areaName">
    </div>

    <!-- Додаємо поле для поверху -->
    <div class="form-group">
      <label for="floor">Поверх</label>
      <input type="number" id="floor" name="floor" required>
    </div>

    <!-- Решта існуючих полів -->
    <div class="form-group">
      <label for="price">Ціна</label>
      <input type="number" id="price" name="price" required>
    </div>

    <!-- Додаємо секцію для тегів -->
    <div class="form-group">
      <label>Теги</label>
      <div class="tags-container">
        <div th:each="tag : ${availableTags}" class="tag-checkbox">
          <input type="checkbox"
                 th:id="${'tag-' + tag.id}"
                 th:name="selectedTags"
                 th:value="${tag.id}">
          <label th:for="${'tag-' + tag.id}" th:text="${tag.name}"></label>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="location">Місцезнаходження</label>
      <input type="text" id="location" name="location" required>
    </div>

    <div class="form-group">
      <label for="roomCount">Кількість кімнат</label>
      <input type="number" id="roomCount" name="roomCount" required>
    </div>

    <div class="form-group">
      <label for="area">Площа</label>
      <input type="number" id="area" name="area" required>
    </div>

    <div class="form-group">
      <label for="timePeriod">Період оренди</label>
      <select id="timePeriod" name="timePeriod" required>
        <option value="day">День</option>
        <option value="week">Тиждень</option>
        <option value="month">Місяць</option>
        <option value="year">Рік</option>
      </select>
    </div>

    <div class="form-group">
      <label for="housingType">Тип житла</label>
      <select id="housingType" name="housingType" required>
        <option value="apartment">Квартира</option>
        <option value="house">Будинок</option>
        <option value="room">Кімната</option>
      </select>
    </div>

    <div class="form-group">
      <label for="status">Статус</label>
      <select id="status" name="status">
        <option value="available">Доступно</option>
        <option value="not_available">Недоступно</option>
      </select>
    </div>

<!--    <div class="mb-3">-->
<!--      <label class="form-label">Фотографії*</label>-->
<!--      <div class="upload-zone p-3 text-center border rounded mb-2"-->
<!--           id="dropZone"-->
<!--           style="border: 2px dashed #ccc; cursor: pointer;">-->
<!--        <i class="fas fa-cloud-upload-alt fa-2x mb-2"></i>-->
<!--        <p class="mb-0">Перетягніть фото сюди або натисніть для вибору</p>-->
<!--        <input type="file"-->
<!--               name="images"-->
<!--               multiple-->
<!--               accept="image/*"-->
<!--               class="d-none"-->
<!--               id="imageInput"-->
<!--               required>-->
<!--      </div>-->
<!--      <div class="row" id="previewContainer"></div>-->
<!--    </div>-->

    <button type="submit" class="btn-submit">Додати оголошення</button>
  </form>
</div>
<div th:replace="~{fragments/footer :: footer}"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>




  document.querySelectorAll('.form-select, .dropdown-menu input').forEach(element => {
    element.addEventListener('change', function() {
      this.form.submit();
    });
  });

  function toggleDropdown() {
    const dropdown = document.querySelector('.dropdown-multiselect');
    dropdown.classList.toggle('open');
  }

  document.addEventListener('click', function (event) {
    const dropdown = document.querySelector('.dropdown-multiselect');
    if (!dropdown.contains(event.target)) {
      dropdown.classList.remove('open');
    }
  });

  document.addEventListener("DOMContentLoaded", function () {
    const dynamicModal = document.getElementById('dynamicModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    let originalOverflow = document.body.style.overflow;
    let originalPaddingRight = document.body.style.paddingRight;

    const bootstrapModal = new bootstrap.Modal(dynamicModal, {
      backdrop: true,
      keyboard: true,
      focus: true
    });

    dynamicModal.addEventListener('show.bs.modal', function (event) {
      const button = event.relatedTarget;
      const modalType = button.getAttribute('data-modal-type');
      loadModalContent(modalType);
    });

    function loadModalContent(modalType) {
      modalBody.innerHTML = 'Завантаження...';

      let fetchUrl;
      if (modalType === 'login') {
        modalTitle.textContent = 'Вхід на сайт';
        fetchUrl = '/auth/login';
      } else if (modalType === 'registration') {
        modalTitle.textContent = 'Реєстрація на сайті';
        fetchUrl = '/auth/registration';
      } else {
        modalBody.innerHTML = '<p>Невідомий тип модального вікна!</p>';
        return;
      }

      fetch(fetchUrl)
              .then(response => response.text())
              .then(html => {
                modalBody.innerHTML = html;
                attachSwitchHandler();
              })
              .catch(err => modalBody.innerHTML = '<p>Помилка завантаження!</p>');
    }

    function attachSwitchHandler() {
      const switchButtons = modalBody.querySelectorAll('.switch-modal');
      switchButtons.forEach(button => {
        button.addEventListener('click', function (event) {
          event.preventDefault();
          const targetModalType = this.getAttribute('data-modal-type');
          loadModalContent(targetModalType);
        });
      });
    }
  });

</script>
</body>
</html>
