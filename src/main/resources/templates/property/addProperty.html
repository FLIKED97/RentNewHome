<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Добавити оголошення</title>
  <link rel="stylesheet" th:href="@{/css/header-style.css}">
  <link rel="stylesheet" th:href="@{/css/footer-style.css}">
  <link rel="stylesheet" th:href="@{/css/property-add.css}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>
<div class="container ct">
  <h1>Додати оголошення</h1>
  <form th:action="@{/properties/add}" method="POST" th:object="${property}" class="property-form">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <div class="form-group">
      <label for="title">Назва</label>
      <input type="text" id="title" name="title" required>
    </div>

    <div class="form-group">
      <label for="description">Опис</label>
      <textarea id="description" name="description" required></textarea>
    </div>

    <div class="form-group">
      <label for="price">Ціна</label>
      <input type="number" id="price" name="price" required>
    </div>

    <div class="form-group">
      <label for="location">Місцезнаходження</label>
      <input type="text" id="location" name="location" required>
    </div>

    <div class="form-group">
      <label for="roomCount">Кількість кімнат</label>
      <input type="number" id="roomCount" name="roomCount" required>
    </div>

    <div class="form-group">
      <label for="area">Площа</label>
      <input type="number" id="area" name="area" required>
    </div>

    <div class="form-group">
      <label for="timePeriod">Період оренди</label>
      <select id="timePeriod" name="timePeriod" required>
        <option value="day">День</option>
        <option value="week">Тиждень</option>
        <option value="month">Місяць</option>
        <option value="year">Рік</option>
      </select>
    </div>

    <div class="form-group">
      <label for="housingType">Тип житла</label>
      <select id="housingType" name="housingType" required>
        <option value="apartment">Квартира</option>
        <option value="house">Будинок</option>
        <option value="room">Кімната</option>
      </select>
    </div>

    <div class="form-group">
      <label for="status">Статус</label>
      <select id="status" name="status">
        <option value="available">Доступно</option>
        <option value="not_available">Недоступно</option>
      </select>
    </div>

    <button type="submit" class="btn-submit">Додати оголошення</button>
  </form>
</div>
<div th:replace="~{fragments/footer :: footer}"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.querySelectorAll('.form-select, .dropdown-menu input').forEach(element => {
    element.addEventListener('change', function() {
      this.form.submit();
    });
  });

  function toggleDropdown() {
    const dropdown = document.querySelector('.dropdown-multiselect');
    dropdown.classList.toggle('open');
  }

  document.addEventListener('click', function (event) {
    const dropdown = document.querySelector('.dropdown-multiselect');
    if (!dropdown.contains(event.target)) {
      dropdown.classList.remove('open');
    }
  });

  document.addEventListener("DOMContentLoaded", function () {
    const dynamicModal = document.getElementById('dynamicModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    let originalOverflow = document.body.style.overflow;
    let originalPaddingRight = document.body.style.paddingRight;

    const bootstrapModal = new bootstrap.Modal(dynamicModal, {
      backdrop: true,
      keyboard: true,
      focus: true
    });

    dynamicModal.addEventListener('show.bs.modal', function (event) {
      const button = event.relatedTarget;
      const modalType = button.getAttribute('data-modal-type');
      loadModalContent(modalType);
    });

    function loadModalContent(modalType) {
      modalBody.innerHTML = 'Завантаження...';

      let fetchUrl;
      if (modalType === 'login') {
        modalTitle.textContent = 'Вхід на сайт';
        fetchUrl = '/auth/login';
      } else if (modalType === 'registration') {
        modalTitle.textContent = 'Реєстрація на сайті';
        fetchUrl = '/auth/registration';
      } else {
        modalBody.innerHTML = '<p>Невідомий тип модального вікна!</p>';
        return;
      }

      fetch(fetchUrl)
              .then(response => response.text())
              .then(html => {
                modalBody.innerHTML = html;
                attachSwitchHandler();
              })
              .catch(err => modalBody.innerHTML = '<p>Помилка завантаження!</p>');
    }

    function attachSwitchHandler() {
      const switchButtons = modalBody.querySelectorAll('.switch-modal');
      switchButtons.forEach(button => {
        button.addEventListener('click', function (event) {
          event.preventDefault();
          const targetModalType = this.getAttribute('data-modal-type');
          loadModalContent(targetModalType);
        });
      });
    }
  });

</script>
</body>
</html>
